<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-layout/app-grid/app-grid-style.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="../bower_components/vaadin-grid/vaadin-grid-filter.html">
<link rel="import" href="../bower_components/vaadin-grid/vaadin-grid-selection-column.html">
<link rel="import" href="../bower_components/vaadin-grid/vaadin-grid-sorter.html">


<link rel="import" href="gnc-currency-formatter.html">
<link rel="import" href="shared-styles.html">

<dom-module id="gnc-detail-table">
	<template>
		<style include="app-grid-style"></style>
	    <style include="shared-styles">
		    :host {
		        display: block;
				color: var(--app-primary-color);
		    }
			vaadin-grid, vaadin-grid-sorter {
				font: 14px "INGMe", Arial, sans-serif;
				color: var(--app-primary-color);
				--lumo-base-color: var(--app-palegrey-color);
				/* --lumo-primary-text-color: var(--app-secondary-color); */
			}
			vaadin-grid {
			}
			vaadin-grid-sorter {
				font-weight: bold;
			}
			vaadin-grid-cell-content {
				text-align: right;
			}
			[slot="vaadin-grid-cell-content-1"] {
				text-align: left;
			}
			.left {
				text-align: left;
			}
			.bold {
				font-weight: bold;
			}
	    </style>
		<h2>[[ label ]]</h2>
		<h3>[[ description ]]</h3>
		<vaadin-grid theme="row-dividers" items="[[ rowData ]]" column-reordering-allowed multi-sort>
			<!-- <vaadin-grid-selection-column auto-select frozen> </vaadin-grid-selection-column> -->
			<vaadin-grid-column width="5%">
				<template><div class="bold">[[ _indexAsRank(index) ]]</div></template>
			</vaadin-grid-column>
			<vaadin-grid-column width="20%" flex-grow="2">
				<template class="header">
					<vaadin-grid-sorter path="party.companyContactName">Name</vaadin-grid-sorter>
					<!-- <vaadin-grid-filter path="party.companyContactName"></vaadin-grid-filter> -->
				</template>
				<template><div class="left">[[ item.party.companyContactName ]]</div></template>
			</vaadin-grid-column>
			<vaadin-grid-column width="20%">
				<template class="header">
					<vaadin-grid-sorter path="amount">
						Amount
					</vaadin-grid-sorter>
				</template>
				<template><gnc-currency-formatter input="[[ item.amount ]]"></gnc-currency-formatter></template>
			</vaadin-grid-column>
			<vaadin-grid-column width="10%">
				<template class="header">
					<vaadin-grid-sorter path="dueDate">
						Terms
					</vaadin-grid-sorter>
				</template>
				<template>[[ _terms(item.invoiceDate, item.dueDate) ]]</template>
			</vaadin-grid-column>
			<vaadin-grid-column width="10%">
				<template class="header">
					<vaadin-grid-sorter path="dueDate">
						Due
					</vaadin-grid-sorter>
				</template>
				<template>[[ _dueDays(item.dueDate) ]]</template>
			</vaadin-grid-column>
			<vaadin-grid-column width="10%">
				<template class="header">
					<vaadin-grid-sorter path="priority">Priority</vaadin-grid-sorter>
				</template>
				<template>[[ _showStars(item.priority) ]]</template>
			</vaadin-grid-column>
		</vaadin-grid>
	</template>

	<script>
		const numberCols = ['days', 'dayslate', 'expected', 'amount'];
		const compareNumbers = (p0, p1) => {
			return p0 > p1 ? 1 : p0 === p1 ? 0 : -1;
		}
		const compareStringsAsNumbers = (p0, p1) => {
			if (p0 == p1) {
				return 0;
			}
			let p0f = Number.parseFloat(p0);
			let p1f = Number.parseFloat(p1);
			return p0f > p1f ? 1 : p0f === p1f ? 0 : -1;
		}

		class GncDetailTable extends Polymer.Element {

			static get is() {
				return 'gnc-detail-table';
			}
			static get properties() {
				return {
					lastSort: String,
					rowData: Array,
					label: String,
					description: String
				};
			}
			_dueDays(d) {
				const timeDiff = Math.abs(Date.now() - Date.parse(d));
				return -1 * Math.ceil(timeDiff / (1000 * 3600 * 24));
			}
			_terms(from, to) {
				const timeDiff = Date.parse(to) - Date.parse(from);
				return Math.ceil(timeDiff / (1000 * 3600 * 24));
			}
			_showStars(num) {
				const stars = [];
				for (var i = 0; i < num; i++) {
					stars.push('●');
				}
				return stars.join('');
			}
			_indexAsRank(idx) {
				return idx + 1;
			}
		}

		window.customElements.define(GncDetailTable.is, GncDetailTable);
	</script>
</dom-module>
