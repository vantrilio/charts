<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-input/paper-input-container.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../bower_components/neon-animation/neon-animatable.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html">

<link rel="import" href="gnc-accounts-detail.html">
<link rel="import" href="gnc-accounts-panel.html">
<link rel="import" href="gnc-dashboard-item.html">
<link rel="import" href="gnc-issue-viewer.html">
<link rel="import" href="gnc-recommendation-viewer.html">
<link rel="import" href="gnc-issues-panel.html">
<link rel="import" href="gnc-recommendations-panel.html">
<link rel="import" href="gnc-kpi-detail.html">
<link rel="import" href="gnc-kpi-panel.html">
<link rel="import" href="rpc-client.html">
<link rel="import" href="gnc-liquidity-forecast.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="rpc-client.html">

<dom-module id="gnc-current">
	<template>
	    <style include="iron-flex"></style>
		<style include="iron-flex-factors"></style>
	    <style include="shared-styles">
	        :host {
	            display: block;
	        }
			.flex-horizontal {
				@apply --layout-horizontal;
			}
			.dialog-close {
				float: right;
				top: 10px;
				font-size: 16px;
				color: var(--app-primary-color);
			}
			.hide {
				visibility: hidden;
			}
			paper-dialog.size-position, gnc-modal-page {
				width: 100%;
				top: -23px;
				background-color: var(--app-palegrey-color);
			}
			paper-tab {
				font-family: 'INGMe', Arial, sans-serif;
				font-size: 16px;
				color: var(--app-text-color);
				font-weight: 700;
			}
			paper-tab.iron-selected {
				color: var(--app-primary-color);
			}
			paper-tabs {
				--paper-tabs-selection-bar-color: var(--app-primary-color);
			}
	    </style>

		<rpc-client method="GetLatestScenario" on-rpc-result="_onScenarioReceived"></rpc-client>
		<paper-icon-button icon="gnc-icons:close" on-click="_dialogClosed"></paper-icon-button>
		<div id="dashboard">
			<div class="flex-horizontal">
				<div class="flex-4">
					<neon-animated-pages
					        id="pages"
					        selected="{{ selectedPage }}"
					        entry-animation="fade-in-animation"
					        exit-animation="fade-out-animation">
				        <neon-animatable>
							<div class="flex-horizontal">
								<div class="flex-3">
									<gnc-dashboard-item item-title="Liquidity" panel-name="graph" on-dashboard-item-zoom="_onDashboardItemZoom">
										<gnc-liquidity-forecast
											draw-graph="[[ graphStateDash ]]"
											forecast="[[ scenario.forecast ]]"
											mode="dashboard"
											accounts="[[ accounts ]]">
										</gnc-liquidity-forecast>
									</gnc-dashboard-item>
								</div>
								<div class="flex-1">
									<gnc-dashboard-item item-title="KPIs" panel-name="kpis" on-dashboard-item-zoom="_onDashboardItemZoom">
										<gnc-kpi-panel kpis="[[ scenario.kpiReport ]]"></gnc-kpi-panel>
									</gnc-dashboard-item>
								</div>
							</div>
							<div class="flex-horizontal">
								<div class="flex-1">
									<gnc-dashboard-item item-title="Top 10 Receivables" panel-name="receivables" on-dashboard-item-zoom="_onDashboardItemZoom">
										<gnc-accounts-panel row-data="[[ accounts.topTenReceivables ]]"></gnc-accounts-panel>
									</gnc-dashboard-item>
								</div>
								<div class="flex-1">
									<gnc-dashboard-item item-title="Top 10 Payables" panel-name="payables" on-dashboard-item-zoom="_onDashboardItemZoom">
										<gnc-accounts-panel row-data="[[ accounts.topTenPayables ]]"></gnc-accounts-panel>
									</gnc-dashboard-item>
								</div>
								<div class="flex-2 flex-veritcal">
									<div class="flex-1">
										<gnc-dashboard-item item-title="Issues" panel-name="issues" on-dashboard-item-zoom="_onDashboardItemZoom">
											<gnc-issues-panel issues="[[ scenario.issues ]]"></gnc-issues-panel>
										</gnc-dashboard-item>
									</div>
									<div class="flex-1">
										<gnc-dashboard-item item-title="Recommendations" panel-name="recommendations" on-dashboard-item-zoom="_onDashboardItemZoom">
											<gnc-recommendations-panel
												recommendations="[[ scenario.recommendations.summary ]]">
											</gnc-recommendations-panel>
										</gnc-dashboard-item>
									</div>
								</div>
					 		</div>
						</neon-animatable>
				        <neon-animatable>
							<paper-tabs id="analysistabs" selected="{{ selectedAnalysisTab }}">
								<paper-tab>KPIs</paper-tab>
								<paper-tab>Issues &amp; opportunities</paper-tab>
								<paper-tab>Recommendations</paper-tab>
							</paper-tabs>
							<iron-pages selected="{{ selectedAnalysisTab }}">
								<gnc-kpi-detail kpis="[[ scenario.kpiReport ]]"></gnc-kpi-detail>
								<gnc-issue-viewer issues="[[ scenario.issues ]]" selected-id="[[ selectedIssueId ]]"></gnc-issue-viewer>
								<gnc-recommendation-viewer
									recommendations="[[ scenario.recommendations.detail ]]"
									selected-id="[[ selectedRecommendationId ]]">
								</gnc-recommendation-viewer>
							</iron-pages>
						</neon-animatable>
				        <neon-animatable>
							<paper-tabs id="accountstabs" selected="{{ selectedAccountsTab }}">
								<paper-tab>Liquidity forecast</paper-tab>
								<paper-tab>Account receivables</paper-tab>
								<paper-tab>Account payables</paper-tab>
							</paper-tabs>
							<iron-pages selected="{{ selectedAccountsTab }}">
								<gnc-liquidity-forecast
									draw-graph="[[ graphStateZoom ]]"
									forecast="[[ scenario.forecast ]]"
									mode="zoomedin"
									accounts="[[ accounts ]]">
								</gnc-liquidity-forecast>
								<gnc-accounts-detail row-data="[[ accounts.receivables ]]"></gnc-accounts-detail>
								<gnc-accounts-detail row-data="[[ accounts.payables ]]"></gnc-accounts-detail>
							</iron-pages>
						</neon-animatable>
				    </neon-animated-pages>
				</div>
			</div>
		</div>

		<rpc-client method="GetLatestScenario" on-rpc-result="_onScenarioReceived"></rpc-client>
		<rpc-client method="GetAccounts" on-rpc-result="_onAccountModelReceived"></rpc-client>
	</template>

	<script>
		class GncCurrent extends Polymer.Element {
			static get is() {
				return 'gnc-current';
			}
			static get properties() {
				return {
					// private
					accounts: Object,
					showGraph: Boolean,
					scenario: Object,
					selectedAnalysisTab: Number,
					selectedAccountsTab: Number,
					payables: Array,
					receivables: Array,
					top10payables: Array,
					graphStateDash: String,
					graphStateZoom: String
				}
			}
			ready() {
				super.ready();
				this.selectedAccountsTab = this.selectedAnalysisTab = this.selectedPage = 0;
				this.showGraph = true;
				this.graphStateZoom = 'no';
				this.graphStateDash = 'yes';
				// this.$.pages.animationConfig = [
				// 	{
				// 	name: 'slide-down-animation',
				// 	node: this.$.pages,
				// 		timing: {
				// 			duration: 500
				// 		}
				// 	},
				// 	{
				// 		name: 'slide-from-bottom-animation',
				// 		node: this.$.pages,
				// 		timing: {
				// 			delay: 1000,
				// 			duration: 500
				// 		}
				// 	}
				// ];
	    		// this.$.pages.animate([
			    //     {transform:'translateY(0)', opacity: 1, easing: 'ease-out'},
			    //     {transform:'translateY(100%)', opacity: 1, easing: 'ease-in'},
			    //     {transform:'translateY(100%)', opacity: 0 }
		    	// ],
			    // {
			    //     duration: 1500,
			    // });
	    	}
			_onDashboardItemZoom(ev) {
				const tab = ['kpis', 'issues', 'recommendations', 'graph', 'receivables', 'payables'].indexOf(ev.detail.panel);
				ev.preventDefault();
				if (tab < 0) {
					return;
				}
				this.graphStateDash = 'no';
				if (tab <= 2) {
					this.graphStateZoom = 'no';
					this.selectedAnalysisTab = tab;
					this.selectedPage = 1;
				} else if (tab === 3) {
					this.graphStateZoom = 'yes';
					this.selectedAccountsTab = 0;
					this.selectedPage = 2;
				} else {
					this.graphStateZoom = 'no';
					this.selectedAnalysisTab = tab - 3;
					this.selectedPage = 2;
				}
				// this.graphStateZoom = 'no';
				// switch(tab) {
				// 	case 0:
				// 	case 1:
				// 	case 2:
				// 		this.selectedAnalysisTab = tab;
				// 		this.selectedPage = 1;
				// 		break;
				// 	case 3:
				// 		this.graphStateZoom = 'yes';
				// 	case 4:
				// 	case 5:
				// 		this.selectedAccountsTab = tab - 3;
				// 		this.selectedPage = 2;
				// 		break;
				// 	default:
				// 		return;
				// }
				//this._dialogClosed();
				//this.$.dashboard.setAttribute('class', 'hide');
				this.zoomin = true;
				this.dispatchEvent(new CustomEvent('zoom-changed', {
					detail: true
				}));
				// if (tab < 3) {
				// 	this.selectedAnalysisTab = tab;
				// 	this.$.analysisview.open();
				// 	return;
				// }
				// this.selectedActualsTab = tab - 3;
				// this.$.actualsview.open();
			}
			_dialogClosed() {
				//this.$.dashboard.setAttribute('class', '');
				if (this.zoomin === false) {
					return;
				}
				this.zoomin = false;
				this.selectedPage = 0;
				this.graphStateZoom = 'no';
				this.graphStateDash = 'yes';

				this.dispatchEvent(new CustomEvent('zoom-changed', {
					detail: false
				}));
			}
			_onScenarioReceived(ev) {
				this.scenario = ev.detail;
			}
			_onAccountModelReceived(ev) {
				this.accounts = ev.detail;
			}
		}

		window.customElements.define(GncCurrent.is, GncCurrent);
	</script>
</dom-module>
